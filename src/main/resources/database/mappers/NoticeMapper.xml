<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<mapper namespace="com.hs.sj.notice.NoticeDAO">
  		
  		<select id="getNoticeList" resultType="NoticeDTO">
  			SELECT * FROM NOTICE
  		</select>
  		
  		<select id="getNoticeDetail" parameterType="NoticeDTO" resultMap="noticeDetailResult">
  			SELECT *
			FROM NOTICE
				LEFT OUTER JOIN
				NOTICEIMG
				USING(NOTICENUMBER)
			WHERE NOTICENUMBER = #{noticeNumber}
  		</select>
  		
  		<resultMap type="NoticeDTO" id="noticeDetailResult">
			<id column="NOTICENUMBER" property="noticeNumber"/>
			<result column="NOTICETITLE" property="noticeTitle"/>
			<result column="NOTICEDETAIL" property="noticeDetail"/>
			<result column="NOTICEWRITER" property="noticeWriter"/>
			<result column="NOTICEDATE" property="noticeDate"/>
			<result column="NOTICEHIT" property="noticeHit"/>
			
			<association property="noticeImgDTO" javaType="NoticeImgDTO">
				<id column="FILENUM" property="fileNum"/>
				<result column="FILENAME" property="fileName"/>
				<result column="ORINAME" property="oriName"/>
			</association>
		</resultMap>
  		
  		<insert id="setNoticeAdd" parameterType="NoticeDTO">
  			<selectKey keyProperty="noticeNumber" resultType="Long" order="BEFORE">
			SELECT NOTICE_SEQ.NEXTVAL FROM DUAL
			</selectKey>
			INSERT INTO NOTICE
			VALUES (#{noticeNumber}, #{noticeTitle}, #{noticeDetail}, #{noticeWriter}, SYSDATE, 1)
  		</insert>
  		
  		<insert id="setNoticeImgAdd" parameterType="NoticeImgDTO">
			INSERT INTO NOTICEIMG
			VALUES (NOTICE_SEQ.NEXTVAL, #{noticeNumber}, #{fileName}, #{oriName})
		</insert>
  		
  		<update id="setNoticeUpdate" parameterType="NoticeDTO">
  			UPDATE NOTICE SET NOTICETITLE = #{noticeTitle}, NOTICEDETAIL = #{noticeDetail}, NOTICEWRITER = #{noticeWriter} 
			WHERE NOTICENUMBER = #{noticeNumber}
  		</update>
  		
  		<delete id="setNoticeDelete" parameterType="NoticeDTO">
  			DELETE NOTICE WHERE NOTICENUMBER = #{noticeNumber} 
  		</delete>
  		
  	</mapper>